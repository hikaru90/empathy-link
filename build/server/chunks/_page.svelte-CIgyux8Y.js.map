{"version":3,"file":"_page.svelte-CIgyux8Y.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/fights/_id_/_page.svelte.js"],"sourcesContent":["import { g as get_store_value, s as subscribe } from \"../../../../chunks/utils.js\";\nimport { o as onDestroy } from \"../../../../chunks/lifecycle.js\";\nimport { c as create_ssr_component, v as validate_component } from \"../../../../chunks/ssr.js\";\nimport { t, a as locale } from \"../../../../chunks/translations.js\";\nimport \"../../../../chunks/Avatar.svelte_svelte_type_style_lang.js\";\nimport \"../../../../chunks/page.js\";\nimport \"clsx\";\nimport \"../../../../chunks/client.js\";\nimport \"../../../../chunks/auth.js\";\nimport { p as page } from \"../../../../chunks/stores.js\";\nimport { s as superForm } from \"../../../../chunks/memoize.js\";\nimport { d as defaults } from \"../../../../chunks/defaults.js\";\nimport \"../../../../chunks/index.js\";\nimport { a as zod, z as zodClient } from \"../../../../chunks/zod.js\";\nimport { z } from \"zod\";\nimport { p as pb } from \"../../../../chunks/pocketbase.js\";\nimport { S as Skeleton } from \"../../../../chunks/skeleton.js\";\nimport \"../../../../chunks/root.svelte_svelte_type_style_lang.js\";\n/* empty css                                                              */\nimport { a as toast } from \"../../../../chunks/Toaster.svelte_svelte_type_style_lang.js\";\nconst schema = z.object({\n  email: z.string().email({ message: get_store_value(t)(\"default.page.login.form.email.validEmailError\") })\n});\nconst css = {\n  code: '.label.svelte-ljnb6t{box-shadow:4px 4px 8px 0 rgba(0, 0, 0, 0.4);position:relative;height:1.75rem;width:1.75rem;flex-shrink:0;border-radius:9999px;border-width:1px;--tw-border-opacity:1;border-color:rgb(255 255 255 / var(--tw-border-opacity))}.label.svelte-ljnb6t:after{content:\"\";box-shadow:-4px -4px 8px 0 white;display:block;height:100%;width:100%;border-radius:9999px}.icon.svelte-ljnb6t{position:absolute;left:50%;top:50%;height:0.875rem;width:0.875rem;--tw-translate-x:-50%;--tw-translate-y:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.skeumorphic-button.svelte-ljnb6t{transition:box-shadow 50ms;box-shadow:var(--skeumorphic-shadow-light)}',\n  map: null\n};\nconst Page = create_ssr_component(($$result, $$props, $$bindings, slots) => {\n  let shareableLink;\n  let $t, $$unsubscribe_t;\n  let $formData, $$unsubscribe_formData;\n  let $locale, $$unsubscribe_locale;\n  let $page, $$unsubscribe_page;\n  $$unsubscribe_t = subscribe(t, (value) => $t = value);\n  $$unsubscribe_locale = subscribe(locale, (value) => $locale = value);\n  $$unsubscribe_page = subscribe(page, (value) => $page = value);\n  let record = void 0;\n  let dialogOpen = false;\n  const data = defaults(zod(schema));\n  const checkValidation = async () => {\n    const validationResult = await validateForm($formData, schema);\n    if (!validationResult.valid) {\n      errors.set(validationResult.errors);\n      return false;\n    }\n    return true;\n  };\n  const form = superForm(data, {\n    // SPA: true,\n    resetForm: false,\n    validators: zodClient(schema),\n    async onSubmit({ validators, cancel }) {\n      console.log(\"onSubmit\");\n      cancel();\n      if (await checkValidation()) {\n        sendLink();\n      }\n    }\n  });\n  const { form: formData, errors, enhance, validate, validateForm } = form;\n  $$unsubscribe_formData = subscribe(formData, (value) => $formData = value);\n  const sendLink = () => {\n    try {\n      const sendMailRes = fetch(\"/api/mails/send\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          template: \"sendLink\",\n          locale: $locale,\n          to: $formData.email,\n          owner: record.expand.owner.firstName,\n          recipientName: record.name,\n          link: shareableLink\n        })\n      });\n      console.log(\"sendMailRes\", sendMailRes);\n      dialogOpen = false;\n      toast.success($t(\"default.menu.share.mailLinkConfirmation\"));\n    } catch (err) {\n      console.log(\"error sending link per mail\");\n      toast.error($t(\"default.menu.share.mailLinkError\"));\n    }\n  };\n  onDestroy(() => {\n    pb.collection(\"responses\").unsubscribe(\"*\");\n  });\n  $$result.css.add(css);\n  let $$settled;\n  let $$rendered;\n  let previous_head = $$result.head;\n  do {\n    $$settled = true;\n    $$result.head = previous_head;\n    shareableLink = `${$page.url.origin}/fights/${$page.params.id}/respond`;\n    $$rendered = `${`<div class=\"flex h-full flex-grow items-center justify-center\">${validate_component(Skeleton, \"Skeleton\").$$render($$result, { class: \"h-[20px] w-[100px] rounded-full\" }, {}, {})}</div>`}`;\n  } while (!$$settled);\n  $$unsubscribe_t();\n  $$unsubscribe_formData();\n  $$unsubscribe_locale();\n  $$unsubscribe_page();\n  return $$rendered;\n});\nexport {\n  Page as default\n};\n"],"names":["t"],"mappings":"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"}